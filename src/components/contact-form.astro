---
import Icon from "astro-icon";
import ContentSection from "./content-section.astro";
---

<ContentSection title="ðŸš€ Unlock High-Quality Leads Now" id="contact">
  <Fragment slot="lead">
    Want more clients? Share your info for a 15-min game-changing chat
  </Fragment>
  <div class="mx-auto w-full lg:py-16">
    <form name="submit-to-google-sheet" class="mx-auto flex w-full max-w-4xl flex-col space-y-8">
      <div class="grid grid-cols-1 gap-5 sm:grid-cols-2">
        <div>
          <label for="name" class="mb-2 block font-medium text-sm">Your name</label>
          <input
            type="text"
            id="name"
            name="userName" 
            class="focus:ring-primary-500 focus:border-primary-500 block w-full rounded-lg border border-gray-300 p-2.5 text-black shadow-sm text-sm"
            placeholder="your name"
            required
          />
        </div>
        <div>
          <label for="company" class="mb-2 block font-medium text-sm">Your Company</label>
          <input
            type="text"
            id="company"
            name="userCompany"
            class="focus:ring-primary-500 focus:border-primary-500 block w-full rounded-lg border border-gray-300 p-2.5 text-black shadow-sm text-sm"
            placeholder="your company"
            required
          />
        </div>
      </div>
      <div>
        <label for="email" class="mb-2 block font-medium text-sm">Your email</label>
        <input
          type="email"
          id="email"
          name="userEmail"
          class="focus:ring-primary-500 focus:border-primary-500 block w-full rounded-lg border border-gray-300 p-2.5 text-black shadow-sm text-sm"
          placeholder="example@captivateclick.com"
          required
        />
      </div>
    
      <button
        type="submit"
        class="flex items-center justify-center gap-3 border-2 border-primary bg-primary px-6 py-4 text-white hover:border-secondary hover:text-secondary"
      >
        <span class="submit-text">Get More Leads Now</span>
        <div class="loader hidden animate-spin h-8 w-8 border-t-2 border-b-2 border-primary rounded-full"></div>
      </button>
    </form>

    <script>
      const scriptURL = 'https://script.google.com/macros/s/AKfycbwIzLe6Hd-8qm40ugHJzI1xNl86hy36FJQusX2F06C2_KS-olhnQcGR5qEuc_v2xn9_pw/exec';
      const form = document.forms['submit-to-google-sheet'];
      const submitButton = form.querySelector('button[type="submit"]');
      const submitText = submitButton.querySelector('.submit-text');
      const loader = submitButton.querySelector('.loader');

      form.addEventListener('submit', async e => {
        e.preventDefault();
        
        // Show loader and hide submit text
        loader.classList.remove('hidden');
        submitText.classList.add('hidden');
        // Disable the submit button
        submitButton.disabled = true;

        try {
          const response = await fetch(scriptURL, { method: 'POST', body: new FormData(form) });
          console.log('Success!', response);
        } catch (error) {
          console.error('Error!', error.message);
        } finally {
          // Hide loader and show submit text
          loader.classList.add('hidden');
          submitText.classList.remove('hidden');
          // Enable the submit button
          submitButton.disabled = false;
          window.location.href = "https://calendly.com/captivateclick/30min";
        }
      });
    </script>

    <style>
      /* This is the spinner animation using Tailwind. You can adjust the size and color as needed. */
      .loader {
        border-width: 2px;
        border-color: transparent;
        border-top-color: currentColor;
      }
    </style>
</div>

</ContentSection>
